{% extends 'core/navigation.html' %}
{% load mathfilters %}


{% block title %}Order Info | {% endblock %}

{% block content %}
<div class="site__body">
    <div class="page-header">
        <div class="page-header__container container">
            <div class="page-header__breadcrumb">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/">Home |</a>
                            <svg class="breadcrumb-arrow" width="6px" height="9px">
                                <use xlink:href="images/sprite.svg#arrow-rounded-right-6x9"></use>
                            </svg>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/shopcart">ShoppingCart | </a>
                            <svg class="breadcrumb-arrow" width="6px" height="9px">
                                <use xlink:href="images/sprite.svg#arrow-rounded-right-6x9"></use>
                            </svg>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </nav>
            </div>
            <div class="page-header__title">
                <h1>Checkout</h1>
            </div>
        </div>
    </div>
    <div class="checkout block">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-6 col-xl-7">
                    <div class="card mb-lg-0">
                        <div class="card-body">
                            <h3 class="card-title">Billing details</h3>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="checkout-first-name">First Name</label>
                                    <input type="text" class="form-control" id="checkout-first-name" placeholder="First Name">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="checkout-last-name">Last Name</label>
                                    <input type="text" class="form-control" id="checkout-last-name" placeholder="Last Name">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="checkout-company-name">Company Name <span class="text-muted">(Optional)</span></label>
                                <input type="text" class="form-control" id="checkout-company-name" placeholder="Company Name">
                            </div>
                            <div class="form-group">
                                <label for="checkout-country">Country</label>
                                <select id="checkout-country" class="form-control form-control-select2">
                                    <option>Select a country...</option>
                                    <option>United States</option>
                                    <option>Russia</option>
                                    <option>Italy</option>
                                    <option>France</option>
                                    <option>Ukraine</option>
                                    <option>Germany</option>
                                    <option>Australia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="checkout-street-address">Street Address</label>
                                <input type="text" class="form-control" id="checkout-street-address" placeholder="Street Address">
                            </div>
                            <div class="form-group">
                                <label for="checkout-address">Apartment, suite, unit etc. <span class="text-muted">(Optional)</span></label>
                                <input type="text" class="form-control" id="checkout-address">
                            </div>
                            <div class="form-group">
                                <label for="checkout-city">Town / City</label>
                                <input type="text" class="form-control" id="checkout-city">
                            </div>
                            <div class="form-group">
                                <label for="checkout-state">State / County</label>
                                <input type="text" class="form-control" id="checkout-state">
                            </div>
                            <div class="form-group">
                                <label for="checkout-postcode">Postcode / ZIP</label>
                                <input type="text" class="form-control" id="checkout-postcode">
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="checkout-email">Email address</label>
                                    <input type="email" class="form-control" id="checkout-email" placeholder="Email address">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="checkout-phone">Phone</label>
                                    <input type="text" class="form-control" id="checkout-phone" placeholder="Phone">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <span class="form-check-input input-check">
                                        <span class="input-check__body">
                                            <input class="input-check__input" type="checkbox" id="checkout-create-account">
                                            <span class="input-check__box"></span>
                                            <svg class="input-check__icon" width="9px" height="7px">
                                                <use xlink:href="images/sprite.svg#check-9x7"></use>
                                            </svg>
                                        </span>
                                    </span>
                                    <label class="form-check-label" for="checkout-create-account">Create an account?</label>
                                </div>
                            </div>
                        </div>
                        <div class="card-divider"></div>
                        <div class="card-body">
                            <h3 class="card-title">Shipping Details</h3>
                            <div class="form-group">
                                <div class="form-check">
                                    <span class="form-check-input input-check">
                                        <span class="input-check__body">
                                            <input class="input-check__input" type="checkbox" id="checkout-different-address">
                                            <span class="input-check__box"></span>
                                            <svg class="input-check__icon" width="9px" height="7px">
                                                <use xlink:href="images/sprite.svg#check-9x7"></use>
                                            </svg>
                                        </span>
                                    </span>
                                    <label class="form-check-label" for="checkout-different-address">Ship to a different address?</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="checkout-comment">Order notes <span class="text-muted">(Optional)</span></label>
                                <textarea id="checkout-comment" class="form-control" rows="4"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6 col-xl-5 mt-4 mt-lg-0">
                    <div class="card mb-0">
                        <div class="card-body">
                            <h3 class="card-title">Your Order</h3>
                            <table class="checkout__totals">
                                <thead class="checkout__totals-header">
                                    <tr>
                                        <th>Product</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody class="checkout__totals-products">
                                    {% for rs in shopcart %} 
                                    <tr>
                                        <td>
                                            {% if rs.variant %}
                                            {{rs.variant.title}}
                                            {% else %} 
                                            {{rs.product}}
                                            {% endif %} × {{rs.quantity}}</td>
                                        <td>{% if rs.product.variant == 'None' %}
                                            {% if rs.product.discount > 0 %}
                                                {{ rs.prodct_dicount_amount }}
                                            {% else %}
                                                {{ rs.amount }}
                                            {% endif %}
                                        {% else %}
                                            {% if rs.variant.discount > 0 %}
                                                {{ rs.var_dicount_amount }}
                                            {% else %}
                                                {{ rs.varamount }}
                                            {% endif %}
                
                                        {% endif %}
                                        {% if rs.product.is_vat == True %}vat incl.{% endif %}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tbody class="checkout__totals-subtotals">
                                    <tr>
                                        <th>Subtotal</th>
                                        <td>${{ sub_total }}</td>
                                    </tr>
                                    <tr>
                                        <th>Store Credit</th>
                                        <td>$-20.00</td>
                                    </tr>
                                    <tr>
                                        <th>Shipping</th>
                                        <td>$25.00</td>
                                    </tr>
                                </tbody>
                                <tfoot class="checkout__totals-footer">
                                    <tr>
                                        <th>Total</th>
                                        <td>${{ total }}</td>
                                    </tr>
                                </tfoot>
                            </table>
                            <div class="payment-methods">
                                <ul class="payment-methods__list">
                                    <li class="payment-methods__item payment-methods__item--active">
                                        <label class="payment-methods__item-header">
                                            <span class="payment-methods__item-radio input-radio">
                                                <span class="input-radio__body">
                                                    <input class="input-radio__input" name="checkout_payment_method" type="radio" checked>
                                                    <span class="input-radio__circle"></span>
                                                </span>
                                            </span>
                                            <span class="payment-methods__item-title">Direct bank transfer</span>
                                        </label>
                                        <div class="payment-methods__item-container">
                                            <div class="payment-methods__item-description text-muted">
                                                Make your payment directly into our bank account. Please use your Order ID as the payment
                                                reference. Your order will not be shipped until the funds have cleared in our account.
                                            </div>
                                        </div>
                                    </li>
                                    <li class="payment-methods__item">
                                        <label class="payment-methods__item-header">
                                            <span class="payment-methods__item-radio input-radio">
                                                <span class="input-radio__body">
                                                    <input class="input-radio__input" name="checkout_payment_method" type="radio">
                                                    <span class="input-radio__circle"></span>
                                                </span>
                                            </span>
                                            <span class="payment-methods__item-title">Check payments</span>
                                        </label>
                                        <div class="payment-methods__item-container">
                                            <div class="payment-methods__item-description text-muted">
                                                Please send a check to Store Name, Store Street, Store Town, Store State / County, Store Postcode.
                                            </div>
                                        </div>
                                    </li>
                                    <li class="payment-methods__item">
                                        <label class="payment-methods__item-header">
                                            <span class="payment-methods__item-radio input-radio">
                                                <span class="input-radio__body">
                                                    <input class="input-radio__input" name="checkout_payment_method" type="radio">
                                                    <span class="input-radio__circle"></span>
                                                </span>
                                            </span>
                                            <span class="payment-methods__item-title">Cash on delivery</span>
                                        </label>
                                        <div class="payment-methods__item-container">
                                            <div class="payment-methods__item-description text-muted">
                                                Pay with cash upon delivery.
                                            </div>
                                        </div>
                                    </li>
                                    <li class="payment-methods__item">
                                        <label class="payment-methods__item-header">
                                            <span class="payment-methods__item-radio input-radio">
                                                <span class="input-radio__body">
                                                    <input class="input-radio__input" name="checkout_payment_method" type="radio">
                                                    <span class="input-radio__circle"></span>
                                                </span>
                                            </span>
                                            <span class="payment-methods__item-title">PayPal</span>
                                        </label>
                                        <div class="payment-methods__item-container">
                                            <div class="payment-methods__item-description text-muted">
                                                Pay via PayPal; you can pay with your credit card if you don’t have a PayPal account.
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="checkout__agree form-group">
                                <div class="form-check">
                                    <span class="form-check-input input-check">
                                        <span class="input-check__body">
                                            <input class="input-check__input" type="checkbox" id="checkout-terms">
                                            <span class="input-check__box"></span>
                                            <svg class="input-check__icon" width="9px" height="7px">
                                                <use xlink:href="images/sprite.svg#check-9x7"></use>
                                            </svg>
                                        </span>
                                    </span>
                                    <label class="form-check-label" for="checkout-terms">
                                        I have read and agree to the website <a target="_blank" href="terms-and-conditions.html">terms and conditions</a>*
                                    </label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-xl btn-block">Place Order</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    var store_opt = document.getElementById('id_delivery_option_0');
    var delivery_opt = document.getElementById('id_delivery_option_1');
    var delivery_express_opt = document.getElementById('id_delivery_option_2');

    var district = document.getElementById('district');
    var district_sel = document.getElementById('id_district');

    var sector = document.getElementById('sector');
    var sector_sel = document.getElementById('id_sector');

    var cell = document.getElementById('cell');
    var cell_sel = document.getElementById('id_cell');

    var village = document.getElementById('village');
    var village_sel = document.getElementById('id_village');

    var address = document.getElementById('address');
    var textArea = document.getElementById('delivery_address');

    var cost = document.getElementById('cost')
    var cost_sel = document.getElementById('id_cost');
    cost.style.display = 'none';
    cost_sel.selectedIndex = 1;

    console.log("display = ", store_opt.parentElement.parentElement.style.display);
    if (store_opt.parentElement.parentElement.style.display == "none") {
        console.log("none");
        delivery_opt.checked = 'checked';
    }

    // Default shown - District Only
    function delivery_shown() {
        district.style.display = 'block';
        district_sel.selectedIndex = 0;

        // cost.style.display = 'block';
        // cost_sel.selectedIndex = 0;

        sector.style.display = 'none';
        sector_sel.selectedIndex = 0;

        cell.style.display = 'none';
        cell_sel.selectedIndex = 0;

        village.style.display = 'none';
        village_sel.selectedIndex = 0;

        address.style.display = 'none';
        textArea.value = "";

        store_opt.checked = false;
    }

    function store_shown() {
        district.style.display = 'none';
        district_opt = document.createElement("option")
        district_opt.value = -1;
        district_sel.appendChild(district_opt);
        district_sel.selectedIndex = 1;

        sector.style.display = 'none';
        sector_opt = document.createElement("option")
        sector_opt.value = -1;
        sector_sel.appendChild(sector_opt);
        sector_sel.selectedIndex = 1;

        cell.style.display = 'none';
        cell_opt = document.createElement("option")
        cell_opt.value = -1;
        cell_sel.appendChild(cell_opt);
        cell_sel.selectedIndex = 1;

        village.style.display = 'none';
        village_opt = document.createElement("option")
        village_opt.value = -1;
        village_sel.appendChild(village_opt);
        village_sel.selectedIndex = 1;

        address.style.display = 'none';
        textArea.value = "*****";

        cost.style.display = 'none';
        cost_sel.selectedIndex = 0;

        delivery_opt.checked = false;

    }

    // Default option - Delivery
    if (delivery_opt.checked == true) {
        console.log('dvopt checked');
        delivery_opt.checked = true;
        store_opt.checked = false;
        if (delivery_express_opt){
            delivery_express_opt.checked = false;
        }
        delivery_shown();
    } else if (delivery_express_opt && delivery_express_opt.checked == true) {
        console.log('deopty checked')
        delivery_express_opt.checked = true;
        delivery_opt.checked = true;
        store_opt.checked = false;
        delivery_shown();
    } else {
        console.log('else');
        delivery_opt.checked = false;
        if (delivery_express_opt) {
            delivery_express_opt.checked = false;
        }
        store_opt.checked = true;
        store_shown();
    }


    store_opt.addEventListener('click', function () {
        store_shown();
    });

    delivery_opt.addEventListener('click', function () {
        delivery_shown();
    });

    if (delivery_express_opt) {
        delivery_express_opt.addEventListener('click', function () {
            delivery_shown();
        });
    }

    // select options
    district_sel.onchange = function () {
        if (this.value == "") {
            cell.style.display = 'none';
            village.style.display = 'none';
            address.style.display = 'none';
        }

        sector_sel.selectedIndex = 0;
        sector.style.display = (this.value == "") ? "none" : "block";
    };
    sector_sel.onchange = function () {
        if (this.value == "") {
            village.style.display = 'none';
            address.style.display = 'none';
        }

        cell_sel.selectedIndex = 0;
        cell.style.display = (this.value == "") ? "none" : "block";
    };
    cell_sel.onchange = function () {
        if (this.value == "") {
            address.style.display = 'none';
        }
        village_sel.selectedIndex = 0;
        village.style.display = (this.value == "") ? "none" : "block";
    };
    village_sel.onchange = function () {
        textArea.value = "";
        address.style.display = (this.value == "") ? "none" : "block";
    };
</script>

<script>
    $("#id_district").change(function () {
        var district_url = "district_sector";
        var districtId = $(this).val();

        if (districtId != '') {
            $.ajax({
                url: district_url,
                data: {
                    'districtId': districtId
                },
                success: function (data) {
                    $("#cell").hide();
                    $("#village").hide();
                    $("#address").hide();

                    var html_data = '<option value="" selected>---Select Sector---</option>';
                    data.forEach(function (data) {
                        html_data += `<option value="${data.id}">${data.sector}</option>`
                    });
                    $("#id_sector").html(html_data);

                }
            });
        }
    });

    $("#id_sector").change(function () {
        var sector_url = "district_sector_cell";
        var districtId = $("#id_district").val();
        var sectorId = $(this).val();

        if (sectorId != '') {
            $.ajax({
                url: sector_url,
                data: {
                    'districtId': districtId,
                    'sectorId': sectorId
                },
                success: function (data) {
                    $("#village").hide();
                    $("#address").hide();

                    var html_data = '<option value="" selected>---Select Cell---</option>';
                    data.forEach(function (data) {
                        html_data += `<option value="${data.id}">${data.cell}</option>`
                    });
                    $("#id_cell").html(html_data);
                }
            });
        }
    });

    $("#id_cell").change(function () {
        var cell_url = "district_sector_cell_village";
        var districtId = $("#id_district").val();
        var sectorId = $("#id_sector").val();
        var cellId = $(this).val();

        if (cellId != '') {
            $.ajax({
                url: cell_url,
                data: {
                    'districtId': districtId,
                    'sectorId': sectorId,
                    'cellId': cellId
                },
                success: function (data) {
                    var html_data = '<option value="" selected>---Select Village---</option>';
                    data.forEach(function (data) {
                        html_data += `<option value="${data.id}">${data.village}</option>`
                    });
                    $("#id_village").html(html_data);
                }
            });
        }
    });
</script>
{% endblock %}